Index: addEvent.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\n// Make session information accessible, allowing us to associate\n// data with the logged-in user.\nsession_cache_expire(30);\nsession_start();\n\nini_set(\"display_errors\", 1);\nerror_reporting(E_ALL);\n\n$loggedIn = false;\n$accessLevel = 0;\n$userID = null;\nif (isset($_SESSION['_id'])) {\n    $loggedIn = true;\n    // 0 = not logged in, 1 = standard user, 2 = manager (Admin), 3 super admin (TBI)\n    $accessLevel = $_SESSION['access_level'];\n    $userID = $_SESSION['_id'];\n}\n// Require admin privileges\nif ($accessLevel < 2) {\n    header('Location: login.php');\n    echo 'bad access level';\n    die();\n}\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\n    require_once('include/input-validation.php');\n    require_once('database/dbEvents.php');\n    $args = sanitize($_POST, null);\n    $required = array(\n        \"name\",\n        \"open_date\",\n        \"due_date\",\n        \"description\",\n        \"completed\",\n    );\n    if (!wereRequiredFieldsSubmitted($args, $required)) {\n        echo 'bad form data';\n        die();\n    } else {\n        $opendate = $args['open_date'] = validateDate($args[\"open_date\"]);\n        $duedate = $args['due_date'] = validateDate($args[\"due_date\"]);\n        //$capacity = intval($args[\"capacity\"]);\n        if (!$opendate || !$duedate > 11) {\n            echo 'bad args';\n            die();\n        }\n        if (isset($_POST['children']) && is_array($_POST['children'])) {\n            $children = $_POST['children'];  // Get the link data from the form\n            unset($_POST['children']);  // Clean up for sanitization\n\n            $args = sanitize($_POST, null);\n\n            $event = make_grant($args);\n\n            $success = create_event($event);\n\n            if ($success) {\n                $grant_id = get_grant_id($event);\n                $count = 0;\n                foreach ($children as $childId) {\n                    $link = make_a_link($args);\n                    add_link($link, $grant_id, $count);\n                    $count = $count + 1;\n                }\n            }\n        }\n    }\n}\n$date = null;\nif (isset($_GET['date'])) {\n    $date = $_GET['date'];\n    $datePattern = '/[0-9]{4}-[0-9]{2}-[0-9]{2}/';\n    $timeStamp = strtotime($date);\n    if (!preg_match($datePattern, $date) || !$timeStamp) {\n        header('Location: calendar.php');\n        die();\n    }\n}\n\n?>\n<!DOCTYPE html>\n<html>\n\n<head>\n    <?php require_once('universal.inc') ?>\n    <title>Downtown Greens | Add Grant</title>\n    <style>\n        input::placeholder {\n            color: white;\n        }\n        </style>\n    </head>\n    <body>\n        <?php require_once('header.php') ?>\n        <h1>Add Grant</h1>\n        <main class=\"date\">\n            <h2>Add Grant Form</h2>\n            <form id=\"new-event-form\" method=\"post\">\n                <label for=\"name\">* Grant Name </label>\n                <input type=\"text\" id=\"name\" name=\"name\" required placeholder=\"Enter name\"> \n                <label for=\"name\">* Open Date </label>\n                <input type=\"date\" id=\"open_date\" name=\"open_date\" style=\"color:white;\" <?php if ($date) echo 'value=\"' . $date . '\"'; ?> min=\"<?php echo date('Y-m-d'); ?>\" required>\n                <label for=\"name\">* Due Date </label>\n                <input type=\"date\" id=\"due_date\" name=\"due_date\" style=\"color:white;\"<?php if ($date) echo 'value=\"' . $date . '\"'; ?> min=\"<?php echo date('Y-m-d'); ?>\" required>\n                <label for=\"name\">* Description </label>\n                <input type=\"text\" id=\"description\" name=\"description\" required placeholder=\"Enter description\">\n                <label for=\"name\" >* Status </label>\n                <select id=\"completed\" name=\"completed\" style=\"color:white;\">\n                    <option value=\"incomplete\" >Incomplete</option>\n                    <option value=\"complete\">Complete!</option>\n                    <option value=\"funded\">Funding Awarded</option>\n                    <option value=\"not_funded\">Funding Failed</option>\n                </select>\n                <label for=\"name\"> Grant Type </label>\n                <input type=\"text\" id=\"type\" name=\"type\" placeholder=\"Enter grant type\">\n                <label for=\"name\"> Partners </label>\n                <input type=\"text\" id=\"partners\" name=\"partners\" placeholder=\"Enter partners\">\n                <label for=\"name\"> Grant Amount </label>\n                <input type=\"text\" id=\"amount\" name=\"amount\" placeholder=\"Enter amount\">\n                <div id=\"dynField-container\"  style=\"margin-top:.5rem;\"></div>\n                <script src= \"js/dynField.js\"></script>\n                \n                <fieldset>\n                    <div id=\"children-container\"></div>\n                    <add-link type=\"button\" onclick=\"addChildForm()\">Add Link</add-link>\n                </fieldset>\n\n                <script>\n                    let childCount = 0;\n                    const children = [];\n\n                    function addChildForm() {\n                        childCount++;\n                        const container = document.getElementById('children-container');\n                        \n                        const childDiv = document.createElement('div');\n                        childDiv.className = 'child-form';\n                        childDiv.id = `child-form-${childCount}`;\n                        \n                        childDiv.innerHTML = `\n                            <label>Link ${children.length + 1}</label>\n\n                            <label for=\"link_name\">Name</label>\n                            <input type=\"text\" id=\"link_name\" name=\"link_name\" required placeholder=\"Enter link name\">\n\n                            <label for=\"link_data\">Link</label>\n                            <input type=\"text\" id=\"link_data\" name=\"link_data\" required placeholder=\"Enter link data\">\n\n                            <link-tag type=\"button\" onclick=\"removeChildForm(${childCount})\">Remove Link</link-tag>\n\n                            <hr>\n                        `;\n                        \n                        container.appendChild(childDiv);\n                        children.push(childDiv);\n                        renumberChildren();\n                }\n\n\n                function removeChildForm(childId) {\n                    // Find the child div to remove\n                    const childDiv = document.getElementById(`child-form-${childId}`);\n                    if (childDiv) {\n                        childDiv.remove(); // Remove the specific child form\n\n                        // Remove the corresponding child element from the array\n                        const index = children.findIndex(child => child.id === `child-form-${childId}`);\n                        if (index > -1) {\n                            children.splice(index, 1);\n                        }\n\n                        // Renumber the children after removal\n                        renumberChildren();\n                    }\n                }\n\n                function renumberChildren() {\n                    // Iterate over each child form and update the displayed child number\n                    children.forEach((child, index) => {\n                        const childHeader = child.querySelector('h4');\n                        childHeader.textContent = `Child ${index + 1}`;\n                    });\n                }\n            </script>\n\n            <p></p>\n            <input type=\"submit\" value=\"Add Grant\">\n        </form>\n        <?php if ($date): ?>\n            <a class=\"button cancel\" href=\"calendar.php?month=<?php echo substr($date, 0, 7) ?>\" style=\"margin-top: -.5rem\">Return to Calendar</a>\n        <?php else: ?>\n            <a class=\"button cancel\" href=\"index.php\" style=\"margin-top: -.5rem\">Return to Dashboard</a>\n        <?php endif ?>\n    </main>\n</body>\n\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/addEvent.php b/addEvent.php
--- a/addEvent.php	(revision dac1b09e038cb313db03d1857f4b639b104363d2)
+++ b/addEvent.php	(date 1731385499388)
@@ -62,6 +62,8 @@
                     add_link($link, $grant_id, $count);
                     $count = $count + 1;
                 }
+                $grant = get_grant_id($event);
+                header("Location: event.php?id=$grant");
             }
         }
     }
@@ -76,7 +78,6 @@
         die();
     }
 }
-
 ?>
 <!DOCTYPE html>
 <html>
